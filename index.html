<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>あぁ…休みてぇ…</title>
</head>
<body>
  <input id="hour" type="text" name="hour" /> :
  <input id="minute" type="text" name="minute" />
  <!-- ここに出力 -->
  <input type="submit" name="set" value="set" onclick="setAlerm()" />
  <div class="time"></div>
  <input type="submit" name="stop" value="stop" onclick="stopAlerm()" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script>
    var mail_timer_id;
    var audio;

    function setAlerm()
    {
      var hour = $("#hour").val();
      var minute = $("#minute").val();

      $(".time").html(hour + ":" + minute);
      setTimeout('checkTime()',3000)
    }

    function checkTime()
    {
      var date = new Date();
      var hour = date.getHours();
      var min = date.getMinutes();

console.log(hour,min);

      var check_hour = $("#hour").val();
      var check_minute = $("#minute").val();

console.log(check_hour,check_minute);

      if (hour == check_hour && min == check_minute) {
        playMusic();
        mail_timer_id = setTimeout('sendMail()',20000);
        return;
      }
      setTimeout('checkTime()',1000)
    }

    function playMusic()
    {
console.log('playMusic');
      audio = new Audio();
      audio.src = "alerm.mp3";
      audio.play();
    }

    function sendMail()
    {
      // mail API叩く
console.log('sendMail');
      audio.pause();
    }

    function stopAlerm()
    {
console.log('stopAlerm');
      clearTimeout(mail_timer_id);
      audio.pause();
    }
  </script>
</body>
</html>
